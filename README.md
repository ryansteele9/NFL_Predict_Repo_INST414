# my_project3

<a target="_blank" href="https://cookiecutter-data-science.drivendata.org/">
    <img src="https://img.shields.io/badge/CCDS-Project%20template-328F97?logo=cookiecutter" />
</a>

## NFL Game Outcome Prediction Pipeline 2025
Predict NFL game point differentials for upcoming NFL weeks in 2025 NFL season. 
Model uses weekly team data, play-by-play analytics, Vegas odds, and other 
engineered features. 

This project implements an end-to-end machine learning pipeline following the
Cookiecutter Data Science structure. Requires API key from SportsDataIO 
(https://discoverylab.sportsdata.io/) to reproduce results.

## Project Statement
NFL games are unpredictable——game outcomes are affected by a host of factors, 
including, but not limited to, team-strength, opponent matchups, injuries, 
strategy, and a lot of randomness.
### Goal:
Build a data-driven model that predicts NFL game outcomes via game point 
differentials. Specifically, this project aims to predict future games in the
2025 season, using historical and 2025 season data. The objective is to predict
the outcome of any future NFL game with >55% accuracy.

## Datasets
| Data Type | Source | Size | Notes |
|----------:|:------:|:----:|:-----:|
| Weekly NFL data (2022-2025) | SportsDataIO (https://discoverylab.sportsdata.io/) | Records: 2024; Columns: 159 | API key required |
| Play-by-play EPA metrics | nflfastR (https://nflfastr.com/) | Records: 2019; Columns: 18 | Used to derive matchup strength features and other advanced metrics |
| Vegas Odds | SportsDataIO (https://discoverylab.sportsdata.io/) | Records: 1160; Columns: 10 | API key required |
| Current Injury Report | CBS Sports (https://www.cbssports.com/nfl/injuries/) | Records: 452; Columns: 4 | Only used for predicting future outcomes, not used in training model |
| Current Week NFL Schedule | SportsDataIO (https://discoverylab.sportsdata.io/) | Records: 15; Columns: 5 | API key required; only used for predicting games in upcoming week |

## Technologies Used
- Python 3.11
- Typer: CLI tooling for some pipeline steps
- pandas, numpy: data engineering
- XGBoost: predictive model used
- scikit-learn: model metrics
- nflfastR, nflreadr: EPA data source
- requests: pull API data
- loguru: structured logging
- matplotlib, seaborn: visualizations

## Modeling Methods
- XGBoost regression
- Rolling time-series train/validation/test splits
- Hyperparamter tuning using grid-search
- Feature importance for feature selection, 31 features used
- Final model tested on all available data

## Results
### Test split results for seasons 2023-2025
| season | MAE | RMSE | R² | Win Accuracy |
|:------:|:---:|:----:|:--:|:------------:|
| 2023 | 9.912 | 12.422 | 0.141 | 61.3% |
| 2024 | 9.618 | 12.544 | 0.279 | 71.1% |
| 2025 | 9.883 | 11.985 | 0.232 | 66.4% |

Uses rolling time-series splits, where for season s:
- Train on seasons < s
- Validate on s weeks 1-5
- Test on s weeks 6+

## Project Organization

```
my_repo2/
├── README.md
├── .env                     ← Stores API keys (SportsData.io), NOT tracked by git
├── .gitignore               ← Ignores raw data, virtual env, etc.
│
├── data/                    ← All data used/generated by pipeline
|   ├── external/            ← External raw data
|   |    ├── injuries/       ← Raw injuries csv
|   |    └── nflfastr/       ← EPA metrics csv
|   |
|   ├── features/            ← Season-team matchups csv with EPA, Elo, Rolling features
|   ├── matchups/            ← Season files with all matchups from season
|   |
|   ├── processed/           ← Data processed by pipeline
|   |    ├── injuries/       ← Processed Injuries
|   |    └── odds/           ← Processed Odds
|   |
|   ├── raw/                 ← Raw data
|   |    ├── odds/           ← Weekly vegas odds
|   |    └── schedules/      ← NFL week schedules 
|   |
|   └── teams/               ← Season-team matchups csv
|
├── my_project3/             ← Main project code
│   ├── config.py            ← API keys and paths
│   │
│   ├── data/                               ← All data used/generated by pipeline
│   |   ├── download_team_stats.py          ← Downloads raw weekly stats from SportsDataIO
│   |   ├── clean_team_stats.py             ← Cleans API responses into structured CSVs
│   |   ├── clean_team_stats_by_team.py     ← Splits by team + season
|   |   ├── nflfastr_build_advanced_stats.R ← Builds EPA metrics csv
|   |   ├── nflfastr_epa.py                 ← Helper function to load EPA metrics csv
│   |   ├── feature_engineering_team.py     ← Adds rolling averages & cumulative features
│   |   ├── build_team_dataset.py           ← Combines all weekly CSVs into season-level files
│   |   ├── build_matchup_data.py           ← Merges opponent stats into matchup rows
|   |   ├── download_odds.py                ← Downloads vegas odds data from SportsDataIO
|   |   ├── team_ratings.py                 ← Helper functions to compute and add Elos to DataFrame
|   |   ├── build_full_matchup_data.py      ← Merges all matchup data files into one for EDA
|   |   ├── download_cbs_injury_report.py   ← Pulls injury report from CBS Sports
|   |   ├── build_injury_adjustment_file.py ← Processes raw injury report file
|   |   └── injury_adjust.py                ← Helper functions to compute and apply injury weights
|   |
|   └── modeling/
|       ├── train.py    ← Makes splits and trains model
|       ├── tune_xgb.py ← Hyperparameter tuning function
|       └── predict.py  ← Creates matchups for upcoming week and makes point spread predictions
│
├── notebooks/
|   ├── multivariate_aalysis.ipynb  ← EDA: Multivariate Analysis
│   ├── univariate_analysis.ipynb   ← EDA: Univariate Analysis
|   ├── verify_odds.ipynb
|   ├── feature_selection.ipynb
|   └── cbs_injury_report.ipynb
│
├── reports/                          ← Final reports, EDA summaries
|   ├── variable_inventory.py         ← Creates CSV file with variable information
|   └── variable_inventory.csv        ← CSV file with variable information
|
├── models/                   ← (Future) Trained models/output
├── requirements.txt          ← Python dependencies
├── pyproject.toml
└── venv/                     ← Virtual environment (ignored by Git)
```

--------
